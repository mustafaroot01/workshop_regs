const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jsQR-DVtnNUI-.js","assets/index-Ci7Uzqco.js","assets/index-CgYta17Y.css"])))=>i.map(i=>d[i]);
import{_ as B,o as U,w as W,E as H,c as r,a as t,d as P,e as G,K,j as J,l as X,F as E,m as z,b as x,t as l,n as S,z as Y,r as c,L as Z,u as $,h as d,s as ee}from"./index-Ci7Uzqco.js";import{s as te}from"./api-jdT4XKC_.js";const ae={class:"page-header"},se={style:{display:"flex","align-items":"center",gap:"1rem"}},ne={class:"scanner-grid"},ie={class:"card scanner-card"},le={class:"camera-wrap",ref:"cameraWrap"},oe={style:{padding:"1rem","text-align":"center"}},re={key:0,style:{"margin-bottom":"1rem"}},de=["value"],ce={style:{color:"var(--text-3)","font-size":"0.82rem","margin-top":"0.75rem"}},ue={style:{display:"flex","flex-direction":"column",gap:"1rem"}},ve={key:0,class:"card result-card"},me={class:"result-name"},pe={class:"result-msg"},_e={key:0,class:"result-details"},ye={class:"detail-row"},fe={class:"detail-val"},ge={class:"detail-row"},he={class:"detail-val"},we={class:"detail-row"},Te={class:"detail-val"},be={key:1,class:"card result-card result-empty"},xe={class:"card",style:{padding:"1.2rem"}},ke={class:"counter-grid"},Ve={class:"counter-item success"},Ae={class:"counter-num"},Ce={class:"counter-item warn"},Ie={class:"counter-num"},Re={class:"counter-item error"},De={class:"counter-num"},Ee={key:2,class:"card",style:{padding:"1.2rem"}},ze={class:"recent-list"},Se={class:"ri-icon"},Le={class:"ri-name"},Me={class:"ri-time"},qe={__name:"AttendanceView",setup(Ne){$();const g=c(null),k=c(null),y=c(!1),o=c(null),f=c([]),p=c({present:0,already:0,invalid:0}),u=c([]),v=c("");let h=null,V=null,T=!1,w="";const i=new(window.AudioContext||window.webkitAudioContext);function A(s){i.state==="suspended"&&i.resume();const e=i.createOscillator(),n=i.createGain();e.connect(n),n.connect(i.destination),s==="success"?(e.type="sine",e.frequency.setValueAtTime(800,i.currentTime),e.frequency.exponentialRampToValueAtTime(1200,i.currentTime+.1),n.gain.setValueAtTime(.5,i.currentTime),n.gain.exponentialRampToValueAtTime(.01,i.currentTime+.1),e.start(),e.stop(i.currentTime+.1)):s==="warn"?(e.type="triangle",e.frequency.setValueAtTime(300,i.currentTime),e.frequency.setValueAtTime(400,i.currentTime+.1),n.gain.setValueAtTime(.5,i.currentTime),n.gain.exponentialRampToValueAtTime(.01,i.currentTime+.2),e.start(),e.stop(i.currentTime+.2)):(e.type="sawtooth",e.frequency.setValueAtTime(150,i.currentTime),n.gain.setValueAtTime(.5,i.currentTime),n.gain.exponentialRampToValueAtTime(.01,i.currentTime+.3),e.start(),e.stop(i.currentTime+.3))}async function L(){try{const s=await navigator.mediaDevices.enumerateDevices();u.value=s.filter(n=>n.kind==="videoinput");const e=u.value.find(n=>n.label.toLowerCase().includes("back")||n.label.toLowerCase().includes("environment"));e?v.value=e.deviceId:u.value.length&&(v.value=u.value[0].deviceId)}catch{}}U(()=>{L()}),W(v,s=>{y.value&&s&&(b(),C())});async function C(){try{const s={video:v.value?{deviceId:{exact:v.value},width:{ideal:1280},height:{ideal:720}}:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}};h=await navigator.mediaDevices.getUserMedia(s),g.value.srcObject=h,y.value=!0,V=setInterval(M,250)}catch{alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.")}}function b(){clearInterval(V),h&&h.getTracks().forEach(s=>s.stop()),y.value=!1}async function M(){var D;if(T||((D=g.value)==null?void 0:D.readyState)!==4)return;const s=g.value,e=k.value,n=Math.min(s.videoWidth,s.videoHeight),a=Math.floor(n*.6),m=(s.videoWidth-a)/2,N=(s.videoHeight-a)/2;e.width=a,e.height=a;const R=e.getContext("2d");R.drawImage(s,m,N,a,a,0,0,a,a);try{const O=R.getImageData(0,0,a,a),j=(await Z(async()=>{const{default:F}=await import("./jsQR-DVtnNUI-.js").then(Q=>Q.j);return{default:F}},__vite__mapDeps([0,1,2]))).default,_=j(O.data,a,a,{inversionAttempts:"dontInvert"});_&&_.data&&_.data!==w&&(w=_.data,await q(_.data),setTimeout(()=>{w===_.data&&(w="")},4e3))}catch{}}async function q(s){var e,n;T=!0;try{const{data:a}=await te(s),m=a.already_attended?"warn":"success";a.already_attended?p.value.already++:p.value.present++,o.value={type:m,name:a.student.name,message:a.message,student:a.student},I(m,a.student.name),A(m)}catch(a){p.value.invalid++,o.value={type:"error",name:"â€”",message:((n=(e=a.response)==null?void 0:e.data)==null?void 0:n.message)||"Ø±Ù…Ø² ØºÙŠØ± ØµØ§Ù„Ø­"},I("error","â€”"),A("error")}finally{T=!1}}function I(s,e){const n=new Date().toLocaleTimeString("ar");f.value.unshift({type:s,name:e,time:n}),f.value.length>6&&f.value.pop()}return H(()=>{b()}),(s,e)=>{const n=Y("router-link");return d(),r("div",null,[t("div",ae,[t("div",se,[P(n,{to:{name:"AdminForms"},class:"btn btn-ghost",style:{padding:"0.4rem 0.8rem"}},{default:G(()=>[...e[1]||(e[1]=[ee("â† Ø±Ø¬ÙˆØ¹",-1)])]),_:1}),e[2]||(e[2]=t("div",null,[t("h2",{class:"gradient-text"},"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±"),t("p",{style:{color:"var(--text-3)","font-size":"0.85rem","margin-top":"0.2rem"}},"Ø§Ù…Ø³Ø­ Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨")],-1))])]),t("div",ne,[t("div",ie,[t("div",le,[t("video",{ref_key:"videoEl",ref:g,autoplay:"",playsinline:"",muted:"",class:"camera-video"},null,512),t("canvas",{ref_key:"canvasEl",ref:k,style:{display:"none"}},null,512),e[3]||(e[3]=K('<div class="scan-frame" data-v-b133317a><div class="scan-corner tl" data-v-b133317a></div><div class="scan-corner tr" data-v-b133317a></div><div class="scan-corner bl" data-v-b133317a></div><div class="scan-corner br" data-v-b133317a></div><div class="scan-line" data-v-b133317a></div></div>',1))],512),t("div",oe,[u.value.length>1?(d(),r("div",re,[J(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),class:"form-select",style:{"max-width":"300px",margin:"auto"}},[(d(!0),r(E,null,z(u.value,a=>(d(),r("option",{key:a.deviceId,value:a.deviceId},l(a.label||"ÙƒØ§Ù…ÙŠØ±Ø§ "+(u.value.indexOf(a)+1)),9,de))),128))],512),[[X,v.value]])])):x("",!0),y.value?(d(),r("button",{key:2,class:"btn btn-danger",onClick:b,style:{padding:"0.85rem 2rem"}}," â¹ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ")):(d(),r("button",{key:1,class:"btn btn-primary",onClick:C,style:{padding:"0.85rem 2rem"}}," ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ")),t("p",ce,l(y.value?"ÙˆØ¬Ù‘Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø­ØªÙ‰ ÙŠÙƒÙˆÙ† Ø§Ù„Ø±Ù…Ø² Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©":"Ø§Ø¶ØºØ· Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­"),1)])]),t("div",ue,[o.value?(d(),r("div",ve,[t("div",{class:S(["result-icon",o.value.type])},l(o.value.type==="success"?"âœ…":o.value.type==="warn"?"âš ï¸":"âŒ"),3),t("h3",me,l(o.value.name),1),t("p",pe,l(o.value.message),1),o.value.student?(d(),r("div",_e,[t("div",ye,[e[4]||(e[4]=t("span",{class:"detail-lbl"},"Ø§Ù„Ù‚Ø³Ù…",-1)),t("span",fe,l(o.value.student.department),1)]),t("div",ge,[e[5]||(e[5]=t("span",{class:"detail-lbl"},"Ø§Ù„Ù…Ø±Ø­Ù„Ø©",-1)),t("span",he,l(o.value.student.stage),1)]),t("div",we,[e[6]||(e[6]=t("span",{class:"detail-lbl"},"Ø§Ù„ÙˆØ±Ø´Ø©",-1)),t("span",Te,l(o.value.student.form_title),1)])])):x("",!0)])):(d(),r("div",be,[...e[7]||(e[7]=[t("div",{style:{"font-size":"3rem"}},"ğŸ“¡",-1),t("p",{style:{color:"var(--text-3)","margin-top":"0.75rem"}},"ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø³Ø­ Ø±Ù…Ø² QR...",-1)])])),t("div",xe,[e[11]||(e[11]=t("h3",{style:{color:"var(--text-2)","font-size":"0.85rem","text-transform":"uppercase","letter-spacing":"0.08em"}},"Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø©",-1)),t("div",ke,[t("div",Ve,[t("div",Ae,l(p.value.present),1),e[8]||(e[8]=t("div",{class:"counter-lbl"},"ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ù‡Ù…",-1))]),t("div",Ce,[t("div",Ie,l(p.value.already),1),e[9]||(e[9]=t("div",{class:"counter-lbl"},"Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹",-1))]),t("div",Re,[t("div",De,l(p.value.invalid),1),e[10]||(e[10]=t("div",{class:"counter-lbl"},"Ø±Ù…Ø² ØºÙŠØ± ØµØ§Ù„Ø­",-1))])])]),f.value.length?(d(),r("div",Ee,[e[12]||(e[12]=t("h3",{style:{color:"var(--text-2)","font-size":"0.85rem","text-transform":"uppercase","letter-spacing":"0.08em","margin-bottom":"0.75rem"}},"Ø¢Ø®Ø± Ø§Ù„Ù…Ø³Ø­Ø§Øª",-1)),t("div",ze,[(d(!0),r(E,null,z(f.value,(a,m)=>(d(),r("div",{key:m,class:S(["recent-item",a.type])},[t("span",Se,l(a.type==="success"?"âœ…":a.type==="warn"?"âš ï¸":"âŒ"),1),t("span",Le,l(a.name),1),t("span",Me,l(a.time),1)],2))),128))])])):x("",!0)])])])}}},Fe=B(qe,[["__scopeId","data-v-b133317a"]]);export{Fe as default};
