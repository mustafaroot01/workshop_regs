import{_ as X,o as Y,c as a,a as s,t as d,j as f,v as C,J as Q,b as v,F as D,m as U,l as E,d as Z,e as ee,T as te,r as i,q as se,h as l,n as ae,i as le,s as M}from"./index-Ci7Uzqco.js";import{f as j,l as B,o as F,p as ne,q as oe,v as ie,w as re,x as de,y as ue}from"./api-jdT4XKC_.js";const pe={class:"settings-grid"},me={class:"card settings-section"},ve={class:"section-header"},ce={class:"badge badge-primary"},ye={class:"add-row"},ge=["disabled"],_e={key:0,class:"spinner"},fe={key:1},be={key:0,class:"alert alert-error",style:{"margin-top":"0.5rem","font-size":"0.82rem"}},he={class:"items-list"},we={key:0,style:{"text-align":"center",padding:"1.5rem"}},xe={key:1,class:"empty-msg"},ke={style:{display:"flex","align-items":"center",gap:"0.8rem"}},Ce=["src"],De={key:1,style:{width:"28px",height:"28px","border-radius":"4px",background:"rgba(255,255,255,0.1)",display:"flex","align-items":"center","justify-content":"center","font-size":"0.75rem"}},Ue={class:"item-name"},Ve=["onClick"],Ie={class:"card settings-section"},ze={class:"section-header"},Le={class:"badge badge-secondary"},Se={class:"add-row"},Ne=["value"],Te=["disabled"],$e=["disabled"],Ee={key:0,class:"spinner"},Me={key:1},je={key:0,class:"alert alert-error",style:{"margin-top":"0.5rem","font-size":"0.82rem"}},Be={class:"items-list"},Fe={key:0,class:"empty-msg",style:{color:"var(--text-2)","font-weight":"500"}},Ke={key:1,style:{"text-align":"center",padding:"1.5rem"}},qe={key:2,class:"empty-msg"},Je={class:"item-name"},Ae=["onClick"],Oe={class:"card settings-section",style:{"margin-top":"1.5rem"}},Pe={class:"section-header"},Qe={class:"badge badge-success"},Re={class:"add-row"},Ge=["disabled"],He=["value"],We=["disabled"],Xe={key:0,class:"spinner"},Ye={key:1},Ze={key:0,class:"alert alert-error",style:{"margin-top":"0.5rem","font-size":"0.82rem"}},et={class:"items-list",style:{"margin-top":"1rem","max-height":"initial"}},tt={key:0,style:{width:"100%","text-align":"right","border-collapse":"collapse"}},st={style:{padding:"0.8rem 0.5rem","font-weight":"600"}},at={style:{padding:"0.8rem 0.5rem",color:"var(--text-2)","font-family":"monospace"}},lt={style:{padding:"0.8rem 0.5rem"}},nt={key:0,style:{"font-size":"0.7rem",color:"var(--text-3)",display:"block","margin-top":"4px"}},ot={style:{padding:"0.8rem 0.5rem"}},it=["onClick"],rt={key:1,style:{"text-align":"center"}},dt={class:"modal card",style:{"max-width":"380px","text-align":"center"}},ut={style:{color:"var(--text-3)","margin-top":"0.5rem","line-height":"1.6"}},pt={style:{display:"flex",gap:"0.8rem","margin-top":"1.8rem"}},mt=["disabled"],vt={key:0,class:"spinner"},ct={__name:"SettingsView",setup(yt){const y=i([]),k=i([]),h=i([]),w=i(""),V=i(null),N=i(null),x=i(""),c=i(""),o=i({name:"",email:"",password:"",role:"scanner",department_id:""}),b=i(null),K=i(!0),q=i(!0),J=i(!0),I=i(""),z=i(""),L=i(""),m=i({dept:!1,interest:!1,user:!1}),u=i(null),S=i(!1),A=se(()=>c.value?k.value.filter(n=>n.department_id===c.value):[]);function R(n){V.value=n.target.files[0]||null}async function G(){const[n,t,e]=await Promise.all([j(),B(),F()]);y.value=n.data,K.value=!1,k.value=t.data,q.value=!1,h.value=e.data,J.value=!1;const p=JSON.parse(localStorage.getItem("admin_user")||"{}");b.value=p.department_id||null,b.value&&(o.value.role="scanner",o.value.department_id=b.value)}Y(()=>{(localStorage.getItem("admin_role")||"admin")!=="admin"?window.location.href="/admin":G()});async function O(){var n,t,e,p,g,_;if(w.value.trim()){m.value.dept=!0,I.value="";try{const r=new FormData;r.append("name",w.value.trim()),V.value&&r.append("logo",V.value),await ne(r),w.value="",V.value=null,N.value&&(N.value.value="");const{data:$}=await j();y.value=$}catch(r){I.value=((p=(e=(t=(n=r.response)==null?void 0:n.data)==null?void 0:t.errors)==null?void 0:e.name)==null?void 0:p[0])||((_=(g=r.response)==null?void 0:g.data)==null?void 0:_.message)||"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©"}finally{m.value.dept=!1}}}async function P(){var n,t,e,p,g,_;if(!(!x.value.trim()||!c.value)){m.value.interest=!0,z.value="";try{await oe({name:x.value.trim(),department_id:c.value}),x.value="";const{data:r}=await B();k.value=r}catch(r){z.value=((p=(e=(t=(n=r.response)==null?void 0:n.data)==null?void 0:t.errors)==null?void 0:e.name)==null?void 0:p[0])||((_=(g=r.response)==null?void 0:g.data)==null?void 0:_.message)||"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©"}finally{m.value.interest=!1}}}async function H(){var n,t,e,p,g,_;if(!(!o.value.name||!o.value.email||!o.value.password)){m.value.user=!0,L.value="";try{const r={...o.value};r.department_id||delete r.department_id,await ie(r),o.value={name:"",email:"",password:"",role:(b.value,"scanner"),department_id:b.value||""};const{data:$}=await F();h.value=$}catch(r){L.value=((p=(e=(t=(n=r.response)==null?void 0:n.data)==null?void 0:t.errors)==null?void 0:e.email)==null?void 0:p[0])||((_=(g=r.response)==null?void 0:g.data)==null?void 0:_.message)||"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø£Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…."}finally{m.value.user=!1}}}function T(n,t,e){u.value={type:n,id:t,name:e}}async function W(){var n,t;if(u.value){S.value=!0;try{if(u.value.type==="dept"){await re(u.value.id);const{data:e}=await j();y.value=e}else if(u.value.type==="interest"){await de(u.value.id);const{data:e}=await B();k.value=e}else if(u.value.type==="user"){await ue(u.value.id);const{data:e}=await F();h.value=e}u.value=null}catch(e){alert(((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"ØªØ¹Ø°Ø± Ø§Ù„Ø­Ø°Ù.")}finally{S.value=!1}}}return(n,t)=>(l(),a("div",null,[t[24]||(t[24]=s("div",{style:{"margin-bottom":"1.5rem"}},[s("h2",{class:"gradient-text"},"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"),s("p",{style:{color:"var(--text-3)","font-size":"0.9rem","margin-top":"0.3rem"}},"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª")],-1)),s("div",pe,[s("div",me,[s("div",ve,[t[10]||(t[10]=s("h3",null,"ðŸ›ï¸ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…",-1)),s("span",ce,d(y.value.length),1)]),s("div",ye,[f(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),type:"text",class:"form-input",placeholder:"Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯...",onKeyup:Q(O,["enter"])},null,544),[[C,w.value]]),s("input",{type:"file",ref_key:"deptLogoInput",ref:N,onChange:R,class:"form-input",style:{"max-width":"200px",padding:"0.4rem"},accept:"image/*"},null,544),s("button",{class:"btn btn-primary",onClick:O,disabled:!w.value.trim()||m.value.dept},[m.value.dept?(l(),a("span",_e)):(l(),a("span",fe,"+"))],8,ge)]),I.value?(l(),a("div",be,d(I.value),1)):v("",!0),s("div",he,[K.value?(l(),a("div",we,[...t[11]||(t[11]=[s("div",{class:"spinner"},null,-1)])])):y.value.length===0?(l(),a("div",xe,"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ø¨Ø¹Ø¯")):v("",!0),(l(!0),a(D,null,U(y.value,e=>(l(),a("div",{key:e.id,class:"item-row"},[s("div",ke,[e.logo_url?(l(),a("img",{key:0,src:e.logo_url,style:{width:"28px",height:"28px","border-radius":"4px","object-fit":"cover",background:"white"}},null,8,Ce)):(l(),a("div",De,"ðŸ¢")),s("span",Ue,d(e.name),1)]),s("button",{class:"btn btn-danger",style:{padding:"0.3rem 0.6rem","font-size":"0.8rem"},onClick:p=>T("dept",e.id,e.name)},"Ø­Ø°Ù",8,Ve)]))),128))])]),s("div",Ie,[s("div",ze,[t[12]||(t[12]=s("h3",null,"ðŸ’¡ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª",-1)),s("span",Le,d(k.value.length),1)]),s("div",Se,[f(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),class:"form-input",style:{"max-width":"35%"}},[t[13]||(t[13]=s("option",{value:""},"Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…",-1)),(l(!0),a(D,null,U(y.value,e=>(l(),a("option",{key:e.id,value:e.id},d(e.name),9,Ne))),128))],512),[[E,c.value]]),f(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>x.value=e),type:"text",class:"form-input",placeholder:"Ø§Ù‡ØªÙ…Ø§Ù… Ø¬Ø¯ÙŠØ¯...",onKeyup:Q(P,["enter"]),disabled:!c.value},null,40,Te),[[C,x.value]]),s("button",{class:"btn btn-primary",onClick:P,disabled:!x.value.trim()||!c.value||m.value.interest},[m.value.interest?(l(),a("span",Ee)):(l(),a("span",Me,"+"))],8,$e)]),z.value?(l(),a("div",je,d(z.value),1)):v("",!0),s("div",Be,[c.value?q.value?(l(),a("div",Ke,[...t[14]||(t[14]=[s("div",{class:"spinner"},null,-1)])])):A.value.length===0?(l(),a("div",qe,"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¹Ø¯")):v("",!0):(l(),a("div",Fe,"ðŸ‘† ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø¹Ø±Ø¶ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙ‡")),(l(!0),a(D,null,U(A.value,e=>(l(),a("div",{key:e.id,class:"item-row"},[s("span",Je,d(e.name),1),s("button",{class:"btn btn-danger",style:{padding:"0.3rem 0.6rem","font-size":"0.8rem"},onClick:p=>T("interest",e.id,e.name)},"Ø­Ø°Ù",8,Ae)]))),128))])])]),s("div",Oe,[s("div",Pe,[t[15]||(t[15]=s("h3",null,"ðŸ‘¥ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†)",-1)),s("span",Qe,d(h.value.length),1)]),s("div",Re,[f(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.name=e),type:"text",class:"form-input",placeholder:"Ø§Ù„Ø§Ø³Ù…"},null,512),[[C,o.value.name]]),f(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.email=e),type:"email",class:"form-input",placeholder:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"},null,512),[[C,o.value.email]]),f(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>o.value.password=e),type:"password",class:"form-input",placeholder:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"},null,512),[[C,o.value.password]]),f(s("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>o.value.role=e),class:"form-input",style:{"max-width":"150px"},disabled:b.value},[...t[16]||(t[16]=[s("option",{value:"admin"},"Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… (Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…)",-1),s("option",{value:"scanner"},"Ù…Ø§Ø³Ø­ QR ÙÙ‚Ø·",-1)])],8,Ge),[[E,o.value.role]]),b.value?v("",!0):f((l(),a("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=e=>o.value.department_id=e),class:"form-input",style:{"max-width":"180px"}},[t[17]||(t[17]=s("option",{value:""},"(Ø¹Ø§Ù… - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)",-1)),(l(!0),a(D,null,U(y.value,e=>(l(),a("option",{key:e.id,value:e.id},d(e.name),9,He))),128))],512)),[[E,o.value.department_id]]),s("button",{class:"btn btn-primary",onClick:H,disabled:!o.value.name||!o.value.email||!o.value.password||m.value.user},[m.value.user?(l(),a("span",Xe)):(l(),a("span",Ye,"+ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨"))],8,We)]),L.value?(l(),a("div",Ze,d(L.value),1)):v("",!0),s("div",et,[h.value.length>0?(l(),a("table",tt,[t[18]||(t[18]=s("tr",{style:{"border-bottom":"1px solid var(--border)"}},[s("th",{style:{padding:"0.5rem"}},"Ø§Ù„Ø§Ø³Ù…"),s("th",{style:{padding:"0.5rem"}},"Ø§Ù„Ø¨Ø±ÙŠØ¯"),s("th",{style:{padding:"0.5rem"}},"Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©"),s("th",{style:{padding:"0.5rem"}},"Ø¥Ø¬Ø±Ø§Ø¡")],-1)),(l(!0),a(D,null,U(h.value,e=>(l(),a("tr",{key:e.id,style:{"border-bottom":"1px solid rgba(255,255,255,0.05)"}},[s("td",st,d(e.name),1),s("td",at,d(e.email),1),s("td",lt,[s("span",{class:ae(["badge",e.role==="admin"?"badge-primary":"badge-secondary"]),style:{"font-size":"0.75rem"}},d(e.role==="admin"?"Ù…Ø¯ÙŠØ±":"Ù…Ø§Ø³Ø­"),3),e.department?(l(),a("span",nt," ðŸ“Œ "+d(e.department.name),1)):v("",!0)]),s("td",ot,[s("button",{class:"btn btn-danger",style:{padding:"0.3rem 0.6rem","font-size":"0.8rem"},onClick:p=>T("user",e.id,e.name)},"Ø­Ø°Ù",8,it)])]))),128))])):J.value?(l(),a("div",rt,[...t[19]||(t[19]=[s("div",{class:"spinner"},null,-1)])])):v("",!0)])]),Z(te,{name:"fade"},{default:ee(()=>[u.value?(l(),a("div",{key:0,class:"modal-backdrop",onClick:t[9]||(t[9]=le(e=>u.value=null,["self"]))},[s("div",dt,[t[22]||(t[22]=s("div",{style:{"font-size":"3rem","margin-bottom":"1rem"}},"âš ï¸",-1)),t[23]||(t[23]=s("h3",{style:{color:"var(--text-1)"}},"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù",-1)),s("p",ut,[M(" Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù "+d(u.value.type==="dept"?"Ø§Ù„Ù‚Ø³Ù…":u.value.type==="user"?"Ø§Ù„Ø­Ø³Ø§Ø¨":"Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…")+" ",1),s("b",null,'"'+d(u.value.name)+'"',1),t[20]||(t[20]=M("ØŸ ",-1))]),s("div",pt,[s("button",{class:"btn btn-danger",style:{flex:"1"},onClick:W,disabled:S.value},[S.value?(l(),a("span",vt)):v("",!0),t[21]||(t[21]=M(" Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù ",-1))],8,mt),s("button",{class:"btn btn-ghost",style:{flex:"1"},onClick:t[8]||(t[8]=e=>u.value=null)},"Ø¥Ù„ØºØ§Ø¡")])])])):v("",!0)]),_:1})]))}},ft=X(ct,[["__scopeId","data-v-d3c9d6c2"]]);export{ft as default};
